## 简述TCP 三次握手以及四次挥手的流程。为什么需要三次握手以及四次挥手？

* 三次握手
  * 第一次握手:客户端给服务端发一个SYN报文，并指明客户端的初始化序列号ISN。此时客户端处于SYN_SEND状态。
  * 第二次握手:服务器收到客户端的SYN报文之后，会以自己的SYN报文作为应答，并且也是指定了自己的初始化序列号ISN。同时会把客户端的ISN+1  
    作为ACK值，表示自己已经收到了客户端的SYN，此时服务器处理SYN_RCVD的状态。
  * 第三次握手:客户端收到SYN报文之后，会发送一个ACK报文，当然，也是一样把服务器的ISN+1作为ACK的值，表示已经收到了服务端的SYN报文，此时  
    客户端处于ESTABLISHED状态，服务器收到ACK报文之后，也处于ESTABLISHED状态，此时双方建立起了连接。
    
* 四次挥手
  * 第一次挥手:客户端发送一个FIN报文给服务端，此时客户端就不会再发送数据，报文中会指定一个序列号，此时客户端处于FIN_WAIT1状态。
  * 第二次挥手:服务端收到FIN报文之后，会发送ACK报文，并且把客户端发送来的报文的序列号+1作为ACK报文的序列号值，表名服务端已经收到了  
    客户端的报文，此时服务端处于CLOSE_WAIT状态。
  * 第三次挥手:如果服务端也想断开连接了，和客户端的第一次挥手一样，发送FIN报文，且指定一个序列号，此时服务端处于LAST_ACK状态。
  * 第四次挥手:客户端收到FIN之后，一样发送一个ACK报文作为应答，并且把服务端的序列号值+1作为自己ACK报文的序列号值，此时客户端处于  
    TIME_WAIT状态。最后需要等待一会以确保服务端收到自己的ACK报文之后才会进入CLOSED状态，服务端收到ACK报文之后，就处于关闭连接的  
    （CLOSED）状态了

* TCP三次握手的原因：  
  （1）为了实现可靠数据传输，TCP协议的通信双方，都必须维护一个序列号，以标识  
发送出去的数据包中，哪些是已经被对方收到的。三次握手的过程也是双方相互告知序列号起始值，并确认对方  
  已经收到了序列号起始值的必经步骤。  
  （2）如果只是两次握手的话，至多只有连接发起方的起始序列号能被确认，另一方选择的序列号则得不到确认。
  
* TCP四次挥手的原因:
   因为当服务端收到客户端的SYN连接请求报文之后，可以直接发送SYN+ACK报文。其中ACK报文是用来应答的，SYN报文是用来同步的。但是关闭连接  
  时，当服务端收到FIN报文时，很可能并不会立即关闭SOCKET，所以只能先回复一个ACK报文来响应给客户端。只有等到服务端的报文都发送完毕了之后，  
  服务端才能发送FIN报文，因此不能一次发送。所以需要四次挥手。